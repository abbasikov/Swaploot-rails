<div class="p-6">
    <%= form_tag(home_update_active_account_path, method: :post, id: 'postForm') do %>
        <%= label_tag(:steamAccountSelect, @active_steam_account ? 'Steam Account:' : 'Choose Steam Account:', class: "text-2xl font-bold") %>
        <%= select_tag('steam_id', options_for_select([['Select an account', nil]] + @steam_accounts.map { |steam_account| ["#{steam_account.unique_name} ID: (#{steam_account.steam_id})", steam_account.steam_id] }, selected: @active_steam_account ? @active_steam_account.steam_id : "Select an account" ), id: 'steamAccountSelect', class: "w-[25%] rounded-lg p-2", onchange: 'submitForm()') %>
    <% end %>
    <hr class="bg-gray-400 h-px w-full my-3">
    <div class="flex">
        <h1 class="text-2xl font-bold">Balance</h1>
        <i class="fa fa-refresh cursor-pointer" aria-hidden="true" id="refresh-balance"></i>
    </div>

    <div class="balance-container" id="balance-container">
    </div>

    <hr class="bg-gray-400 h-px w-full mb-3">
     <div style= "display: flex;">
    <h2 class="text-2xl font-bold mb-4">Active Trades</h2>
        <i id="refreshactiveTrade" class="fa fa-refresh" aria-hidden="true"></i>
    </div>
 
    <%= render partial: 'active_trade' ,locals: { active_trades: @active_trades } %>
       
</div>
</div>


<div class="flex">
<div class="table-1">
 <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div style= "display: flex;">
    <h2 class="text-2xl font-bold mb-4">Item listed for sale</h2>
        <i class="fa fa-refresh" aria-hidden="true"></i>
    </div>

    <table id="dataTableInvetory" class="display" style="width:100%">
        <thead>
            <tr>
                <th class="px-4 py-2">Item ID</th>
                <th class="px-4 py-2">Market Name</th>
                <th class="px-4 py-2">Price</th>
                <th class="px-4 py-2">Site</th>
                <th class="px-4 py-2">Date</th>
            </tr>
        </thead>
        <tbody>
            <% @item_listed_for_sale_hash.each do |item_listed_for_sale_hash| %>
                <tr>
                    <td class="border text-center px-4 py-2"><%= item_listed_for_sale_hash['item_id'] %></td>
                    <td class="border text-center px-4 py-2"><%= item_listed_for_sale_hash['market_name'] %></td>
                    <td class="border text-center px-4 py-2"><%= "$#{item_listed_for_sale_hash['price'].to_f / 1000}" %></td>
                    <td class="border text-center px-4 py-2"><%= item_listed_for_sale_hash['site'] %></td>
                    <td class="border text-center px-4 py-2"><%= Time.parse(item_listed_for_sale_hash['date']).strftime("%d/%B/%Y") %></td>
                </tr>
            <% end %>
        </tbody>
    </table>
</div>
</div>

<div class="table-2">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <%= render partial: 'item_sold', locals: { sold_items: @items_sold }%>
    </div>
</div>

</div>

<script>
    function refreshBalance() {
      $.ajax({
        url: '<%= refresh_balance_path %>', // Replace with your actual route path
        type: 'GET',
        dataType: 'script',
      });
    };

    $('#refresh-balance').on('click', function () {
        refreshBalance();
    });

    $(document).ready(function() {
        refreshBalance();
        $('#dataTableItemsSold').DataTable();
         $('#dataTableInvetory').DataTable({
            "order": [[2, 'desc']],
        });
        $('#dataTableActiveTrades').DataTable();

        const searchInputs = document.querySelectorAll('input[type="search"]');
        searchInputs.forEach(function(input) {
            input.style.marginBottom = '10px'
        });

        const dataTables = document.querySelectorAll('.dataTable');
        dataTables.forEach((el)=>{
            el.style.border = '1px solid black';
        })

        var elements = document.querySelectorAll('.dataTables_length');
        for (var i = 0; i < elements.length; i++) {
            elements[i].parentNode.removeChild(elements[i]);
        }
     });

        function submitForm() {
            document.getElementById("postForm").submit();
        }
  
    var dataTableActiveTrades = $('#dataTableActiveTrades').DataTable();
      $('#refreshactiveTrade').click(function() {
        $.ajax({
            url: '<%= home_active_trades_reload_path(format: :js) %>',
            method: 'GET',
            error: function(jqXHR, textStatus, errorThrown) {
                console.error('Error refreshing table', textStatus, errorThrown);
            }
        });
      });
    </script>
